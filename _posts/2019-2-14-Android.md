---
layout: post
title: 安卓开发各种问题汇总
---

# 概览

安卓开发各种问题汇总

## 破解、反编译

### 查看Manifest 
可以使用[apktool](https://ibotpeaches.github.io/Apktool/install/) 

{% highlight Android %}
apktool d /Users/zhangruquan/Downloads/com.sina.weibo3829.apk
{% endhighlight %}

### 查壳

[查壳工具](https://github.com/QuanGe/QuanGe.github.io/raw/master/ApkScan-PKID.jar)

### 反编译

#### 360加固过的apk

需要一台root过的安卓机器，我手里的是小米3，直接使用开发版本系统就默认带root。

##### 查看手机是32还是64位系统

在命令行输入 adb shell getprop ro.product.cpu.abi 命令查看当前手机的CPU是32位还是64位;输入x86表示是32位，x64则为64位

##### 上传drizzleDumper到手机上

[drizzleDumper](https://github.com/QuanGe/QuanGe.github.io/raw/master/drizzleDumper.zip)使用adb push 命令将对应版本的破解工具上传到手机的/data/local/tmp/ 目录；

{% highlight Android %}
adb push drizzleDumper /data/local/tmp/
{% endhighlight %}

#####  在手机端破解

进入手机端控制台

使用adb shell 命令进入android手机的命令行；

{% highlight Android %}
cd /data/local/tmp

su

chmod 777 drizzleDumper

./drizzleDumper com.xxx 5
{% endhighlight %}

破解成功后执行 exit



adb pull /data/local/tmp/com.xxxx_dumped_38.dex  可将刚刚破解得到的dex文件下载到电脑上。

#### 未加固的apk

如果apk里有多个dex则可能使用过混淆，并未加固，下载并解压[dex2jar](https://github.com/pxb1988/dex2jar/releases).

{% highlight Android %}
sh ./d2j-dex2jar.sh weibo.apk
{% endhighlight %}

执行完，会在dex-tools文件夹里发现com.sina.weibo3829-dex2jar.jar

### 查看源码

#### 查看jar源码 

使用 [jd-gui](https://github.com/QuanGe/QuanGe.github.io/raw/master/jd-gui-osx-1.4.0.tar)

#### 查看dex源码

使用 [jadx](https://github.com/QuanGe/QuanGe.github.io/raw/master/jadx-0.7.1.zip)






## 适配问题

#### 全面屏的适配

从小米MIX 1发布以来，越来越多所谓“全面屏”手机发布，如三星S8，小米MIX2，VIVO X20，Google Pixel2等等，全面屏手机大致思路都是压缩额头与下巴，屏幕比例从传统的16：9变为18：9，提高屏占比以及屏幕内的虚拟导航键。如果不适配则上下会有黑边。适配的两种方法如下：

第一种方法targetSdkVersion==24（Android7.0）及以上默认支持了分屏模式，即Manifest文件中配置Activity的android:resizeableActivity默认属性为true
{% highlight Android %}
android:resizeableActivity="true"
{% endhighlight %}

采用此方法的有腾讯视频、腾讯新闻

第二种方法 在应用配置文件AndroidManifest.xml中显式声明支持的最大屏幕高宽比（maximum aspect ratio）。其中 ratio_float 为高宽比：
　　传统屏幕：ratio_float = 16/9 = 1.778 ；
　　三星S8屏幕：ratio_float = 18.5/9 = 2.056。
　　红米6pro屏幕：ratio_float = 19/9 = 2.111。
　　鉴于目前全面屏屏幕比例，将ratio_float设置为2.2即可适配一众全面屏手机。

{% highlight Android %}
<meta-data
            android:name="android.max_aspect"
            android:value="2.2"/>

{% endhighlight %}

采用此方法的有 网易新闻
{% highlight Android %}
<meta-data android:name="android.max_aspect" android:value="2.4"/>
{% endhighlight %}
叽里呱啦、新浪微博
{% highlight Android %}
<meta-data android:name="android.max_aspect" android:value="2.5"/>
{% endhighlight %}

#### 图标兼容 Android8.0 及旧版本

[drawable和mipmap的区别](https://developer.android.com/guide/topics/resources/providing-resources)

drawable ：
位图文件（.png、.9.png、.jpg、.gif）或编译为以下可绘制对象资源子类型的 XML 文件：

位图文件
九宫格（可调整大小的位图）
状态列表
形状
动画可绘制对象
其他可绘制对象

mipmap ： 适用于不同启动器图标密度的可绘制对象文件

##### 启动图标到底要放到哪里？

要放到哪里取决于产品经理，现在用androidstudio 创建默认放在mipmap，而且安卓8.0以后app图标的圆角还是方角可以交给系统来决定。如果你放在mipmap就要坐Android8.0的适配，把图标分为前后两个图标，后面的图标为背景图标，前面为主logo。这样在Android 8.0上如果交给系统来决定app图标，那么有可能为圆形，也有可能为圆角的正方形。

不过如果产品经理要求无论在什么版本系统上都要圆角的正方形，那么你就要舍弃 mipmap。我们来看看各个APP的实现。

新浪微博：android:icon="@drawable/logo" 

腾讯新闻：android:icon="@mipmap/icon"

腾讯视频：android:icon="@drawable/icon"

网易新闻：android:icon="@drawable/icon"

叽里呱啦：android:icon="@drawable/ic_launcher"




